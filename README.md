# MetArea
MetArea tool proposes Meta Area under curve computation to estimate cooperative transcription factor (TF) binding in ChIP-seq data.

# Description
For a pairs of motifs conventional recognition accuracy is calculated as a partial area under curve (pAUC, [Tsukanov et al., 2022](https://doi.org/10.3389/fpls.2022.938545)). Generalisation of this accuracy measure to joint curve for these two motifs allows to compute a common accuracy for these two motifs. Testing of multiple possible combinations of motifs allows to detect most strongly reinforcing each other. The tested motifs can present either structurally different types of binding sites for the same TF, or binding sites of diferent TFs acting as part of a single multi-protein complex. Thus, MetArea predicts motifs with synergistically related functions. Synergy is recognizwd as higher jount pAUC value pAUC(1&2) of a combination of two motif models compared to any pAUC value from single motif models pAUC1 and pAUC2, Ratio = pAUC(1&2) / Max(pAUC1, pAUC2) > 1. MetArea can be applied to the motifs either of the traditional PWM (Position Weight Matrix) or alternative models, e.g. [SiteGA](https://github.com/parthian-sterlet/sitega). 

# Algorithm
MetArea algorighm implies computation of the Receiver Operating Characteristic (ROC) curve for a combination of two motifs. For a single motif the ROC curve represents the relationship between the rates of true positive (TP) and false positive (FP) presictions. For each recognition threshold TP rate denotes the fraction of sequences from the foreground set (ChIP-seq peaks) containing predicted sites of a motif. For each recognition threshold we define FP rate as the freqiency of a motif in a backgound set of seqiences ([Tsukanov et al., 2022](https://doi.org/10.3389/fpls.2022.938545)). The background set means genomic sequences with A/T content matching that for the sequences from the foregdound set. Preliminary, for each motif model, we use the promoter sequences of protein coding genes from whole genomes to compute -Log10(ERR) values (Expected Recognition Rate, ERR). These values measure various motif model in the uniform scale. Thus, in terms of FP rate computed through ERR, for any pair of sites of two models we can estimate which of two sites respects higher affinity. 

For a combination of two motifs, the joint TP rate is defined similarly as ones for single motifs. The joint TP rate is a fraction of sequences containing hits of at least of one of two motifs. The joint FP rate requres correction since sites of two models may overlap each other. 

- If two sites of two models do not overlap, the joint FP rate increases additively by two, dFP = 2. We see two distinct sites in a sequence.
- If these two sites possess the full overlap, the joint FP rate increases only by one, dFP = 1. We see one site in a sequence.
- If two sites show the partial overlap, the joint FP rate increases an non-integer impact between one and two (1 < dFP < 2), depending on the ratios between the overlap length (L), and the lengths of motifs W1 and W2, dFP = (L/W1 + L/W2)/2 = L*(W1 + W2)/(W1*W2)/2.

The cases of full or partial overlaps imply that joined FP rate possesses the best estimate of ERR for two sites, -Log10(ERR,joined) = Max( -Log10(ERR1),  -Log10(ERR2)).

# Main input data

- FASTA file for the set of foreground sequences (peaks). This set represents top-scored peaks derived from ChIP-seq experiment (1000 peaks of best quality is default option).
- FASTA file for the set background sequences. This set consisted of sequences extracted from the whole genome for the respective species, use [AntiNoise](https://denovosea.icgbio.ru/antinoise/) with default genomic or promoters options. These options mean extraction of background sequences from a whole genome or only those of them mapped to promoters of protein coding genes. It is expected the promoters option is the best one. Do not use shuffled sequences or any other sequences generated by Markov models of different orders as a background set - such an option drastically reduces the quality of the output results.
- A couple of motif models, e.g. a Position Frequency Matrices representing PWM motifs
- Two lists of recognition thresholds for two motif models. These lists are computated as recognition score distribution for the set of whole-genome promoter sequences selected for respective species, as it was described earlier for [MCOT](https://webmcot.sysbio.cytogen.ru/) [(Levitsky et al., 2019)](https://doi.org/10.1093/nar/gkz800) and [SiteGA](https://github.com/parthian-sterlet/sitega) [(Tsukanov et al., 2022)](https://doi.org/10.3389/fpls.2022.938545). 

# Running modes

- One PWM motif model vs. another PWM motif model.
- Traditional PWM motif model vs. alternative [SiteGA](https://github.com/parthian-sterlet/sitega) motif model. The SiteGA model was chosen as the most methodologically different from the tradiotional PWM.
- One PWM motif model vs. all motifs for known TFs from a given collection [Hocomoco v12](http://hocomoco12.autosome.ru/) or [JASPAR2024](https://jaspar.elixir.no/).
- Best performed motifs from the collection of PWM motifs for known TFs for certain taxon or species. The performances of all motifs from a given collection are estimated by pAUC, then all possible {N * (N - 1)/2} pairwise combinations of motifs for the top-scored M motifs of all N motifs in the collection. Available options includes the collections of 1420/1142 motifs for 942/713 human/mouse TFs from [Hocomoco v12](http://hocomoco12.autosome.ru/) ([Vorontsov et al., 2024](https://doi.org/10.1093/nar/gkad1077)), of 556/151 motifs for 555/148 plant/insect TFs from [JASPAR2024](https://jaspar.elixir.no/) [Rauluseviciute et al., 2024](https://doi.org/10.1093/nar/gkad1059).

# Source code and command line arguments

- One PWM motif model vs. another PWM motif model, [pauc_forback_2motifs_only.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_2motifs_only.cpp)
1. input FASTA file,foreground set pf sequences, peaks, example - [top 1000 peaks for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa) from [GTRD](https://gtrd.biouml.org/#!)
2. input FASTA file, background set of sequences, genomic sequences, [A/T-matched random pieces of DNA of the same length from promoters](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2_pb.fa) genomic sequences from promoters extracted by [AntiNoise](https://denovosea.icgbio.ru/antinoise/) 
3. input binary files for the first motif model (PWM1), [example](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B.binary). This file integrates in the binary format [PFM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B.pcm), [PWM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B.pwm), [the motif length, and total number of  recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B.dist). The binary files for PWM models are generated by [PWM thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [MCOT](https://github.com/parthian-sterlet/mcot-kernel).
4. input binary files for the second motif model (PWM2), [example](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.1.SM.B.binary). This file integrates in the binary format [PFM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.1.SM.B.pcm), [PWM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.1.SM.B.pwm), [the motif length, and total number of  recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.1.SM.B.dist). The binary files for PWM models are generated by [PWM thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [MCOT](https://github.com/parthian-sterlet/mcot-kernel).
5. output file, ROC curves for the motif models PWM1 and PWM2, and for the joint model PWM1&PWM2, see [example, ROC curves for PWM1, PWM2 and joint PWM1&PWM2 models](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B_BHA15.H12CORE.1.SM.B.roc)
6. output file, two pAUC values for the motifs models PWM1 and PWM2 and for the joint model PWM1&PWM2, [example, pAUC values for PWM1, PWM2 and joint PWM1&PWM2 models](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B_BHA15.H12CORE.1.SM.B.pauc)
   
- Traditional PWM vs. alternative SiteGA motif models, [pauc_forback_pwm_sga_only.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_pwm_sga_only.cpp)
1. input FASTA file,foreground set pf sequences, peaks, example - [top 1000 peaks for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa) from [GTRD](https://gtrd.biouml.org/#!)
2. input FASTA file, background set of sequences, genomic sequences, [A/T-matched random pieces of DNA of the same length from promoters](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2_pb.fa) genomic sequences from promoters extracted by [AntiNoise](https://denovosea.icgbio.ru/antinoise/) 
3. input binary file for PWM motif model, [example](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm.binary). This file integrates in the binary format [PFM](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15.pfm), [PWM](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15.pwm), [the motif length, and total number of  recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm_ERR.dist). The binary files for PWM models are generated by [PWM thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [MCOT](https://github.com/parthian-sterlet/mcot-kernel). 
4. input binary file for SiteGA motif model, [example](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_sga.binary). This file integrates in the binary format [the matrix of SiteGA model](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_sga.mat), including the motif length, [the total number of recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_sga_ERR.dist). The binary files for SiteGA models are generated by [SiteGA thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [SiteGA](https://github.com/parthian-sterlet/sitega)
5. output file, ROC curves for the motif models PWM and SiteGA, and for the joint model PWM&SiteGA, see [example, ROC curves for PWM, SiteGA and joint PWM&SiteGA models](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm_sga.roc)
6. output file, pAUC values for the motif models PWM and SiteGA and for the joint model PWM&SiteGA, [example, pAUC values for PWM, SiteGA and joint PWM&SiteGA models](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm_sga.pauc)

- One PWM motif model vs. all motifs for known TFs from a given collection, [pauc_forback_anc_lib.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_anc_lib.cpp)
1. input FASTA file,foreground set pf sequences, peaks, example - [top 1000 peaks for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa) from [GTRD](https://gtrd.biouml.org/#!)
2. input FASTA file, background set of sequences, genomic sequences, [A/T-matched random pieces of DNA of the same length from promoters](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2_pb.fa) genomic sequences from promoters extracted by [AntiNoise](https://denovosea.icgbio.ru/antinoise/)
3. input binary file for PWM motif model, [example](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm.binary). This file integrates in the binary format [PFM](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15.pfm), [PWM](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15.pwm), [the motif length, and total number of  recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm_ERR.dist). The binary files for PWM models are generated by [PWM thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [MCOT](https://github.com/parthian-sterlet/mcot-kernel).
4. input binary file for the collection of PWM motif models, available options: two collections of human and murine motifs from [Hocomoco v12](http://hocomoco12.autosome.ru/), see archive files in [partners folder](https://github.com/parthian-sterlet/metarea/tree/main/partners), two collections for plant and insect TFs from [JASPAR2024](https://jaspar.elixir.no/), [JASPAR2024_insects](https://github.com/parthian-sterlet/metarea/blob/main/partners/jaspar24_dm6.binary) and [JASPAR2024_plants](https://github.com/parthian-sterlet/metarea/blob/main/partners/jaspar24_dm6.binary) These files in the binary format integrate for all motifs in each collection [PFM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15.pfm), [PWM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15.pwm), [the motif length, and total number of  recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm_ERR.dist). The binary files for PWM models are generated by [PWM thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [MCOT](https://github.com/parthian-sterlet/mcot-kernel). 
5. output file, list of joint pAUC values satisfying the synergy criterion Ratio > 1, [example list of joint pAUC values for synergetic pairs of motifs](https://github.com/parthian-sterlet/metarea/blob/main/examples/anc_lib/PEAKS039234_BHLHA15_pwm.pauc)
6. output file, list of joint pAUC values for all pairs of motifs, [example example list of joint pAUC values for all pairs of motifs](https://github.com/parthian-sterlet/metarea/blob/main/examples/anc_lib/PEAKS039234_BHLHA15_pwm.log)

- Best performed motifs from the collection of PWM motifs for known TFs for certain taxon or species, [pauc_forback_2motifs.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_2motifs.cpp)
1. input FASTA file,foreground set pf sequences, peaks, example - [top 1000 peaks for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa) from [GTRD](https://gtrd.biouml.org/#!)
2. input FASTA file, background set of sequences, genomic sequences, [A/T-matched random pieces of DNA of the same length from promoters](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2_pb.fa) genomic sequences from promoters extracted by [AntiNoise](https://denovosea.icgbio.ru/antinoise/)
3. input binary file for the collection of PWM motif models, available options: two collections of human and murine motifs from [Hocomoco v12](http://hocomoco12.autosome.ru/), see archive files in [partners folder](https://github.com/parthian-sterlet/metarea/tree/main/partners), two collections for plant and insect TFs from [JASPAR2024](https://jaspar.elixir.no/), [JASPAR2024_insects](https://github.com/parthian-sterlet/metarea/blob/main/partners/jaspar24_dm6.binary) and [JASPAR2024_plants](https://github.com/parthian-sterlet/metarea/blob/main/partners/jaspar24_dm6.binary) These files in the binary format integrate for all motifs in each collection [PFM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15.pfm), [PWM](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15.pwm), [the motif length, and total number of  recognition thresholds, the full list of thresholds and ERR values](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_sga/PEAKS039234_BHLHA15_pwm_ERR.dist). The binary files for PWM models are generated by [PWM thresholds selection program](https://github.com/parthian-sterlet/mcot-kernel/blob/master/src/pwm_thr_err/pwm_iz_pwm_thr_dist0.cpp) from [MCOT](https://github.com/parthian-sterlet/mcot-kernel)
4. int value, the number of M top-scored motifs to check pairwise synergy
5. output file, the matrix of all (M*(M-1)) joint pAUC values and of all (M*(M-1)) Ratio values for all tested pairs of M top-scored motifs, [example_of output_matrices](https://github.com/parthian-sterlet/metarea/blob/main/examples/lib_lib/PEAKS039234_BHLHA15_Q9QYC3_MACS2.auc_mat)
6. output file pAUC, list of joint pAUC values for all pairs of motifs formed by top-scored M motifs, these pairs satisfy the synergy criterion Ratio > 1, [example list of joint pAUC values for synergetic pairs of motifs](https://github.com/parthian-sterlet/metarea/blob/main/examples/lib_lib/PEAKS039234_BHLHA15_Q9QYC3_MACS2.auc_mat)
7. output file log1, list of pAUC values for all single motifs from the collection, [example list of pAUC values fo single motifs](https://github.com/parthian-sterlet/metarea/blob/main/examples/lib_lib/PEAKS039234_BHLHA15_Q9QYC3_MACS2.auc_log1)
8. output file log2, list of joint pAUC values for all pairs of motifs formed by top-scored M motifs, [example list of joint pAUC values for all pairs of motifs](https://github.com/parthian-sterlet/metarea/blob/main/examples/lib_lib/PEAKS039234_BHLHA15_Q9QYC3_MACS2.auc_log2)

# Command line examples

- One PWM motif model vs. another PWM motif model, [pauc_forback_2motifs_only.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_2motifs_only.cpp)

[pwm_sga](https://github.com/parthian-sterlet/metarea/blob/main/run/pwm_sga) command line for PWM and SiteGA motif models for [the peaks dataset PEAKS039234 for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa). Two models derived from this dataset with _de novo_ motif search.

- Traditional PWM vs. alternative SiteGA motif models, [pauc_forback_pwm_sga_only.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_pwm_sga_only.cpp)
 
[pwm_pwm](https://github.com/parthian-sterlet/metarea/blob/main/run/pwm_pwm) command line for two PWM models [BHA15.H12CORE.0.P.B.pcm](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.0.P.B.pcm) and [BHA15.H12CORE.1.SM.B.pcm](https://github.com/parthian-sterlet/metarea/blob/main/examples/pwm_pwm/BHA15.H12CORE.1.SM.B.pcm) respecting two structurally distinct motif types from [Hocomoco v12](http://hocomoco12.autosome.ru/) for the same murine BHLHA15 TF and [the peaks dataset PEAKS039234 for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa)

- One PWM motif model vs. all motifs for known TFs from a given collection, [pauc_forback_anc_lib.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_anc_lib.cpp)
 
[anc_lib](https://github.com/parthian-sterlet/metarea/blob/main/run/anc_lib) command line for PWM motif model derived by _de novo_ motif search for [the peaks dataset PEAKS039234 for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa) and the collection of motifs for murine TFs from [Hocomoco v12](http://hocomoco12.autosome.ru/)

- Best performed motifs from the collection of PWM motifs for known TFs for certain taxon or species, [pauc_forback_2motifs.cpp](https://github.com/parthian-sterlet/metarea/blob/main/src/pauc_forback_2motifs.cpp)

[lib_lib](https://github.com/parthian-sterlet/metarea/blob/main/run/anc_lib) command line to test [the peaks dataset PEAKS039234 for mouse BHLHA15 TF](https://github.com/parthian-sterlet/metarea/blob/main/examples/PEAKS039234_BHLHA15_Q9QYC3_MACS2.fa) for top-scoring pairwise combiantaion of motifs from the [Hocomoco v12](http://hocomoco12.autosome.ru/) collection for known murine TFs.
All fasta files are represented by ID and RF names from [GTRD](https://gtrd.biouml.org/#!)
